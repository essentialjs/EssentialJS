/*
    Essential JavaScript ‚ùÄ http://essentialjs.com
    Copyright (C) 2011 by Henrik Vendelbo

    This program is free software: you can redistribute it and/or modify it under the terms of
    the GNU Affero General Public License version 3 as published by the Free Software Foundation.

    Additionally,

    Permission is hereby granted, free of charge, to any person obtaining a copy of this software 
    and associated documentation files (the "Software"), to deal in the Software without restriction, 
    including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
    and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, 
    subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING 
    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
function Resolver(e,t,n){"use strict";function r(e,r){var i=n.generator||Generator(Object),s=t;for(var o=0,u;u=e[o];++o){var a=s;s=s[u];if(s==undefined)switch(r){case undefined:case"generate":s=a[u]=i();break;case"null":return null;case"throw":throw new Error("The '"+u+"' part of '"+e.join(".")+"' couldn't be resolved.")}}return s}function i(e,t,n,r){n[r]=e,typeof e=="object"&&e.__generator__==e&&(e.info.symbol=r,e.info["package"]=t.join("."),e.info.within=n)}function s(e,t){return typeof e=="object"?r(e.name.split("."),e.onundefined):r(e.split("."),t)}switch(typeof e){case"undefined":return Resolver["default"];case"string":return Resolver[e]==undefined&&(n==undefined&&(n=t,t={}),Resolver[e]=Resolver(t,n),Resolver[e].named=e),Resolver[e]}return n=t||{},t=e,e=n.name,s.named=e,s.namespace=t,s.declare=function(e,t,n){var s=e.split("."),o=s.pop(),u=r(s,n);return u[o]===undefined?(i(t,s,u,o),t):u[o]},s.set=function(e,t,n){var s=e.split("."),o=s.pop(),u=r(s,n);return i(t,s,u,o),t},s.reference=function(e,t){function s(){var e=r(n,t);return e}function o(e){var s=n.pop(),o=r(n,t);return n.push(s),i(e,n,o,s),e}function u(e){var s=n.pop(),o=r(n,t);return n.push(s),o[s]===undefined?(i(e,n,o,s),e):o[s]}function a(e,s){var o=n.pop(),u=r(n,t);n.push(o),u[o]===undefined&&i({},n,u,o),u[o][e]===undefined&&(u[o][e]=s)}function f(e,s){var o=n.pop(),u=r(n,t);n.push(o),u[o]===undefined&&i({},n,u,o),u[o][e]=s}function l(e){var s=n.pop(),o=r(n,t);n.push(s),o[s]===undefined&&i({},n,o,s);for(var u in e)o[s][u]=e[u]}var n=e.split(".");return s.set=o,s.get=s,s.declare=u,s.mixin=l,s.declareEntry=a,s.setEntry=f,s},s.override=function(e,t){t=t||{};var n=t.name||this.named;return Resolver[n]=Resolver(e,t),Resolver[n].named=n,Resolver[n]},n.mixinto&&(n.mixinto.declare=s.declare,n.mixinto.set=s.set,n.mixinto.reference=s.reference,n.mixinto.override=s.override),s}function Generator(e,t){function r(e,t,r,i,s,o,u,a,f,c,h,p){var d;if(l.info.existing){var v=l.info.identifier.apply(l.info,arguments);if(v in l.info.existing)return d=l.info.existing[v];d=l.info.existing[v]=new l.type}else d=new l.type;d.__context__={generator:l,info:n,args:[e,t,r,i,s,o,u,a,f,c,h,p]};for(var f=0,m;m=n.constructors[f];++f)m.apply(d,d.__context__.args);return delete d.__context__,d}function i(t,n,r,i,s,o,u,a,f,c,h,p){var d=e.apply(l,arguments);return d}function s(t,r,i,s,o,u,a,f,c,h,p,d){"no strict";var v;if(l.info.existing){var m=l.info.identifier.apply(l.info,arguments);if(m in l.info.existing)return v=l.info.existing[m];v=l.info.existing[m]=n.extendsBuiltin[arguments.length].apply(null,arguments)}else{v=n.extendsBuiltin[arguments.length].apply(null,arguments);for(var g in l.prototype)v[g]=l.prototype[g];e.prototype=n.extendsBuiltin.ctr.prototype}v.__context__={generator:l,info:n,args:[t,r,i,s,o,u,a,f,c,h,p,d]};for(var c=0,y;y=n.constructors[c];++c)n.extendsBuiltin.ctr!==y&&y.apply(v,v.__context__.args);return delete v.__context__,v}function o(){var e=this.__context__.args;for(var t=0,r;r=l.args[t];++t)if(e[t]===undefined){var i=l.args[t].name,s=l.args[t]["default"];i in n.restrictedArgs?e[t]=n.restrictedArgs[i]:s&&(e[t]=s)}}function u(){for(var e in n.presets)this[e]=n.presets[e]}function a(){var e=this.__context__.generator.args;for(var t=0,n;n=e[t];++t)n.preset&&(this[n.preset]=arguments[t])}function f(e,t){return function(n,r,i,s,o,u,a,f,l,c,h,p){switch(t){case 1:return new e(n);case 2:return new e(n,r);case 3:return new e(n,r,i);case 4:return new e(n,r,i,s);case 5:return new e(n,r,i,s,o);case 6:return new e(n,r,i,s,o,u);case 7:return new e(n,r,i,s,o,u,a);case 8:return new e(n,r,i,s,o,u,a,f);case 9:return new e(n,r,i,s,o,u,a,f,l);case 10:return new e(n,r,i,s,o,u,a,f,l,c);case 11:return new e(n,r,i,s,o,u,a,f,l,c,h);case 12:return new e(n,r,i,s,o,u,a,f,l,c,h,p);default:return new e}}}function c(e,t,n,r,i,s){if(t==undefined){var o=this.variants[e];if(o&&o.generator)return o.generator;var o=this.variants[""];return o&&o.generator?o.generator:this}var u=t.handlers,a=t.bases;this.variants[e]={func:t,generator:Generator(t),handlers:u||{},bases:a||[],additional:[n,r,i,s]}}function h(){var e=[];e.push("function "),e.push(this.info.package),e.push("."),e.push(this.info.symbol),e.push("(");var t=[];for(var n=0,r;r=this.args[n];++n)t.push(r.name+":"+r.variantName);return e.push(t.join(",")),e.push(")"),e.push(" {"),e.push("<br>  "),e.push("<br>  }"),e.push("<br>  "),e.join("")}function p(e,t){if(e.singleton)this.info.singleton=!0,this.info.lifecycle=e.lifecycle,this.info.existing={},this.info.identifier=function(){return 0},this.info.restricted||(Generator.restricted.push(l),this.info.restricted=!0);else if(e.identifier){var n=typeof e.identifier=="string"?e.identifier:"identifier";this.info.identifier=this.info.constructors[-1][n],this.info.existing={},this.info.restricted||(Generator.restricted.push(l),this.info.restricted=!0)}else e.size!=undefined&&(this.info.restricted||(Generator.restricted.push(l),this.info.restricted=!0));return this.info.restrictedArgs=t,t&&this.info.constructors.unshift(o),this}if(e.__generator__)return e.__generator__;var n={arguments:{},presets:{},options:t,constructors:[]},l=function(t){function N(){}var o=t.length-1,l=t[o];typeof l=="function"?l={}:--o,n.options=l;var c=e.bases||[];if(o>0){c=[];for(var h=o,p;h>=1&&(p=t[h]);--h){switch(p){case Array:case String:n.extendsBuiltin={ctr:p};for(var d=12;d>=0;--d)n.extendsBuiltin[d]=f(p,d)}c.push(t[h])}}var v=n.constructors;for(var h=0,m;m=c[h];++h){if(m.bases)for(var g=0,y;y=m.bases[g];++g)v.push(m.bases[g]);v.push(m)}v.push(e),v[-1]=e;var b=r;l.alloc===!1?b=i:n.extendsBuiltin&&(b=s),b.__generator__=b,b.info=n,b.bases=c,b.args=l.args||e.args||[];var w=!1;for(var h=0,E;E=b.args[h];++h)E.no=h,n.arguments[E.name]=E,E.preset&&(w=!0);n.constructors.unshift(u),w&&n.constructors.unshift(a);if(c.length){var S=Generator(c[0]),x=b.prototype=new S.type;for(var h=1,m;m=c[h];++h)for(var T in m.prototype)x[T]=m.prototype[T]}b.type=N,b.type.prototype=b.prototype;for(var T in e.prototype)b.prototype[T]=e.prototype[T];return e.prototype=b.prototype,b}(arguments);return Resolver(l.prototype,{mixinto:l}),l.presets=Resolver(n.presets),l.variant=c,l.variants={},l.toRepr=h,l.restrict=p,e.__generator__=l,l}Resolver["default"]=Resolver({},{name:"default"}),Resolver.hasGenerator=function(e){return e.__generator__?!0:typeof e=="function"&&typeof e.type=="function"?!0:!1},Generator.restricted=[],function(e){"use strict";function n(e){this.options=e||{},this.name=this.options.name,this.preset=this.options.preset===!0?this.name:this.options.preset}function r(e){this.type=String,this.variantName="String"}function i(e){this.type=Number,this.variantName="Number"}function s(e){this.type=Date,this.variantName="Date"}function o(e){this.type=Boolean,this.variantName="Boolean"}function u(e){this.type=Object,this.variantName="Object"}function a(e){this.type=Array,this.variantName="Array"}function f(){this._set={};for(var e=this.length-1;e>=0;--e){var t=this[e];(this._set[t]||t==="")&&this.splice(e,1),t!=""&&t!=null&&(this._set[t]=!0)}}function l(){for(var e=0,t;t=Generator.restricted[e];++e)t.info.lifecycle=="page"&&t()}function c(){for(var e=0,t;t=Generator.restricted[e];++e){var n=t.info.constructors[-1].discarded;for(var r in t.info.existing){var i=t.info.existing[r];n&&n.call(t,i)}t.info.constructors[-1].__generator__=undefined,t.__generator__=undefined}}function p(){if(h)return;h=!0,t("_queueDelayedAssets")(),t.set("_queueDelayedAssets",function(){}),l()}function d(){}function v(){c()}function m(){try{e.document.documentElement.doScroll("left")}catch(t){setTimeout(m,1);return}p()}function g(){if(e.document.addEventListener){var t=function(){e.document.removeEventListener("DOMContentLoaded",t,!1),p()};e.document.addEventListener("DOMContentLoaded",t,!1),e.addEventListener("load",p,!1)}else if(e.document.attachEvent){var n=function(){e.document.readyState==="complete"&&(e.document.detachEvent("onreadystatechange",n),p())};e.document.attachEvent("onreadystatechange",n),e.attachEvent("onload",p);var r=!1;try{r=e.frameElement==null}catch(i){}e.document.documentElement.doScroll&&r&&m()}}function b(){function e(e,t){}y.log=function(){e("none",arguments)},y.trace=function(){e("trace",arguments)},y.debug=function(){e("debug",arguments)},y.info=function(){e("info",arguments)},y.warn=function(){e("warn",arguments)},y.error=function(){e("error",arguments)}}function w(){y.log=function(){window.console.log.apply(window.console,arguments)},y.trace=function(){window.console.trace()},y.debug=function(){(window.console.debug||window.console.info).apply(window.console,arguments)},y.info=function(){window.console.info.apply(window.console,arguments)},y.warn=function(){window.console.warn.apply(window.console,arguments)},y.error=function(){window.console.error.apply(window.console,arguments)},window.console.debug==undefined&&(y.log=function(e){window.console.log(e)},y.trace=function(e){window.console.trace()},y.debug=function(e){window.console.log(e)},y.info=function(e){window.console.info(e)},y.warn=function(e){window.console.warn(e)},y.error=function(e){window.console.error(e)})}var t=Resolver("essential",{});t.set("Type",Generator(n)),t.set("StringType",Generator(r,n)),t.namespace.Type.variant("String",t.namespace.StringType),t.set("NumberType",Generator(i,n)),t.namespace.Type.variant("Number",t.namespace.NumberType),t.set("DateType",Generator(s,n)),t.namespace.Type.variant("Date",t.namespace.DateType),t.set("BooleanType",Generator(o,n)),t.namespace.Type.variant("Boolean",t.namespace.BooleanType),t.set("ObjectType",Generator(u,n)),t.namespace.Type.variant("Object",t.namespace.ObjectType),t.set("ArrayType",Generator(a,n)),t.namespace.Type.variant("Array",t.namespace.ArrayType),t.set("ArraySet",Generator(f,Array)),t.set("DOMTokenList",Generator(f,Array)),f.prototype.item=function(e){return this[e]},f.prototype.has=function(e){return this._set[e]},f.prototype.contains=f.prototype.has=function(e){return Boolean(this._set[e])},f.prototype.set=function(e,t){typeof e=="object",t?this.add(e):this.remove(e)},f.prototype.add=function(e){e in this._set||(this._set[e]=!0,this.push(e))},f.prototype.remove=function(e){if(e in this._set){for(var t=this.length-1;t>=0;--t)this[t]===e&&this.splice(t,1);delete this._set[e]}},f.prototype.toggle=function(e){this.has(e)?this.remove(e):this.add(e)},f.prototype.separator=" ",f.prototype.toString=function(){return this.join(this.separator)},t.set("instantiatePageSingletons",l),t.set("_queueDelayedAssets",function(){});var h=!1;window.device||(g(),e.addEventListener?e.addEventListener("load",d,!1):e.attachEvent("onload",d),e.addEventListener?e.addEventListener("beforeunload",v,!1):e.attachEvent("onbeforeunload",v));var y=t.declare("console",{});t.declare("setStubConsole",b),t.declare("setWindowConsole",w),window.console?w():b()}(window),function(){function i(){this._object=e&&!r?new e:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function s(){return new i}function o(e){e._object.send(e._data);if(t&&!e._async){e.readyState=s.OPENED,f(e);while(e.readyState<s.DONE){e.readyState++,u(e);if(e._aborted)return}}}function u(e){s.onreadystatechange&&s.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function a(e){var t=e.responseXML,r=e.responseText;n&&r&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(r));if(t)if(n&&t.parseError!==0||!t.documentElement||t.documentElement&&t.documentElement.tagName=="parsererror")return null;return t}function f(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=a(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function l(e){e._object.onreadystatechange=new window.Function}var e=window.XMLHttpRequest,t=!!window.controllers,n=window.document.all&&!window.opera,r=n&&window.navigator.userAgent.match(/MSIE 7.0/);s.prototype=i.prototype,t&&e.wrapped&&(s.wrapped=e.wrapped),s.UNSENT=0,s.OPENED=1,s.HEADERS_RECEIVED=2,s.LOADING=3,s.DONE=4,s.prototype.readyState=s.UNSENT,s.prototype.responseText="",s.prototype.responseXML=null,s.prototype.status=0,s.prototype.statusText="",s.prototype.priority="NORMAL",s.prototype.onreadystatechange=null,s.onreadystatechange=null,s.onopen=null,s.onsend=null,s.onabort=null,s.prototype.open=function(e,r,i,o,a){delete this._headers,arguments.length<3&&(i=!0),this._async=i;var c=this,h=this.readyState,p=null;n&&i&&(p=function(){h!=s.DONE&&(l(c),c.abort())},window.attachEvent("onunload",p)),s.onopen&&s.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,r,i,o,a):arguments.length>3?this._object.open(e,r,i,o):this._object.open(e,r,i),this.readyState=s.OPENED,u(this),this._object.onreadystatechange=function(){if(t&&!i)return;c.readyState=c._object.readyState,f(c);if(c._aborted){c.readyState=s.UNSENT;return}c.readyState==s.DONE&&(delete c._data,l(c),n&&i&&window.detachEvent("onunload",p),h!=c.readyState&&u(c),h=c.readyState)}},s.prototype.send=function(e){s.onsend&&s.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,o(this)},s.prototype.sendEncoded=function(e){s.onsend&&s.onsend.apply(this,arguments),arguments.length||(e=null);if(e&&typeof e=="object"){var t=this._headers["Content-Type"];t||(this._object.setRequestHeader("Content-Type","text/json"),t="text/json");switch(t){case"text/json":e=JSON.stringify(e);break;case"application/x-www-form-urlencoded":var n=[];for(var r in e)n.push(r+"="+encodeURIComponent(e[r]));e=n.join("&")}}this._data=e,o(this)},s.prototype.abort=function(){s.onabort&&s.onabort.apply(this,arguments),this.readyState>s.UNSENT&&(this._aborted=!0),this._object.abort(),l(this),this.readyState=s.UNSENT,delete this._data},s.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},s.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},s.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},s.prototype.addEventListener=function(e,t,n){for(var r=0,i;i=this._listeners[r];r++)if(i[0]==e&&i[1]==t&&i[2]==n)return;this._listeners.push([e,t,n])},s.prototype.removeEventListener=function(e,t,n){for(var r=0,i;i=this._listeners[r];r++)if(i[0]==e&&i[1]==t&&i[2]==n)break;i&&this._listeners.splice(r,1)},s.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};t.type=="readystatechange"&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var n=0,r;r=this._listeners[n];n++)r[0]==t.type&&!r[2]&&(r[1].handleEvent||r[1]).apply(this,[t])},s.prototype.toString=function(){return"[object XMLHttpRequest]"},s.toString=function(){return"[XMLHttpRequest]"},Resolver("essential").set("XMLHttpRequest",s)}(),function(){"use strict";function regScriptOnload(e,t){e.onload=function(e){this.onloadDone||(this.onloadDone=!0,t.call(this,e||event))},e.onreadystatechange=function(e){("loaded"===this.readyState||"complete"===this.readyState)&&!this.onloadDone&&(this.onloadDone=!0,t.call(this,e||event))}}function HTMLScriptElement(e,t){var n=(t||document).createElement("SCRIPT");for(var r in e)switch(r){case"id":case"class":case"rel":case"lang":case"language":case"src":case"type":e[r]!==undefined&&(n[r]=e[r]);break;case"onload":regScriptOnload(n,e.onload);break;default:n.setAttribute(r,e[r])}return n}function delayedScriptOnload(e){function t(e){pastloadScripts[this.src.replace(baseUrl,"")]=!0,console.log("loaded: "+this.src.replace(baseUrl,"")),ApplicationConfig().justUpdateState()}return t}function _queueDelayedAssets(){console.debug("loading phased scripts");var links=document.getElementsByTagName("link");for(var i=0,l;l=links[i];++i)if(l.rel=="pastload"){var attrsStr=l.getAttribute("attrs"),attrs={};attrsStr&&eval("attrs = {"+attrsStr+"}"),attrs.type="text/javascript",attrs.src=l.getAttribute("src"),attrs.onload=delayedScriptOnload(l.rel);var relSrc=attrs.src.replace(baseUrl,"");pastloadScripts[relSrc]=!1,document.body.appendChild(HTMLScriptElement(attrs))}}function configRequired(e){requiredConfigs[e]=!1}function configLoaded(e){requiredConfigs[e]=!0,console.debug("config loaded:"+e),ApplicationConfig().justUpdateState()}function _makeEventCleaner(e,t){function n(){if(this.removeEventListener)for(var n in e)this.removeEventListener(n,e[n],t),delete e[n];else for(var n in e)this.detachEvent("on"+n,e[n]),delete e[n]}return n.listeners=e,n}function addEventListeners(e,t,n){function r(e,t){var n=typeof t=="object",r=n?t:e,i=n?t.handleEvent:t;return function(){return i.call(e,window.event)}}e._cleaners==undefined&&(e._cleaners=[]);if(e.addEventListener){for(var i in t)e.addEventListener(i,t[i],n||!1);e._cleaners.push(_makeEventCleaner(t,n||!1))}else{var s={};for(var i in t)s[i]=r(e,t[i]),e.attachEvent("on"+i,s[i]);e._cleaners.push(_makeEventCleaner(s,n||!1))}}function callCleaners(e){var t=e._cleaners;if(t!=undefined){for(var n=0,r;r=t[n];++n)r.call(e);t=undefined}}function DialogAction(e){this.actionName=e}function resizeTriggersReflow(e){DocumentRolesGenerator()._resize_descs()}function enhanceUnhandledElements(){var e=ApplicationConfig(),t=DocumentRolesGenerator.presets("handlers");DocumentRolesGenerator()._enhance_descs()}function DocumentRoles(e){this.handlers=e||this.handlers||{enhance:{},discard:{},layout:{}},this._on_event=[];var t=ApplicationConfig();window.addEventListener?(window.addEventListener("resize",resizeTriggersReflow,!1),document.body.addEventListener("orientationchange",resizeTriggersReflow,!1)):window.attachEvent("onresize",resizeTriggersReflow),document.querySelectorAll?this.descs=this._role_descs(document.querySelectorAll("*[role]")):this.descs=this._role_descs(document.getElementsByTagName("*")),this._enhance_descs()}function form_onsubmit(e){var t=this;return setTimeout(function(){t.submit()},0),!1}function form_submit(){document.activeElement&&document.activeElement.blur(),this.blur(),dialog_submit.call(this)}function dialog_submit(e){var t="trigger";if(this.elements)for(var n=0,r;r=this.elements[n];++n)r.type=="submit"&&(t=r.name);else{var i=this.getElementsByTagName("button");for(var n=0,r;r=i[n];++n)r.type=="submit"&&(t=r.name);var s=this.getElementsByTagName("input");for(var n=0,r;r=s[n];++n)r.type=="submit"&&(t=r.name)}e&&e.name&&(t=e.name);if(!this.actionVariant){var o=this.getAttribute("action");o?o=o.replace(baseUrl,""):o="submit",this.actionVariant=DialogActionGenerator.variant(o)(o)}if(this.actionVariant[t])this.actionVariant[t](this);else{var u=t.replace("-","_").replace(" ","_");this.actionVariant[u]&&this.actionVariant[u](this)}}function toolbar_submit(e){return dialog_submit.call(this,e)}function form_blur(){for(var e=0,t;t=this.elements[e];++e)t.blur()}function form_focus(){for(var e=0,t;t=this.elements[e];++e){var n=t.getAttribute("autofocus");if(n==undefined)continue;t.focus();break}}function applicable_role_element(e){while(e){var t=e.getAttribute("role");if(t)return e;e=e.parentNode}}function dialog_button_click(e){e=e||event;var t=e.target||e.srcElement,n=applicable_role_element(t);n&&n.getAttribute("role")=="button"?this.submit(n):t.type=="submit"&&this.submit(t)}function _lookup_generator(e,t){var n=Resolver(t||"default")(e,"null");return n?Generator(n):null}function Layouter(e,t,n){}function StageLayouter(e,t,n){this.key=e,this.type=n.layouter,this.areaNames=n["area-names"],this.activeArea=null,this.baseClass=n["base-class"],this.baseClass?this.baseClass+=" ":this.baseClass="",stages.push(this)}function Laidout(e,t,n){}function MemberLaidout(e,t,n){this.key=e,this.type=n.laidout,this.areaNames=n["area-names"],this.baseClass=n["base-class"],this.baseClass?this.baseClass+=" ":this.baseClass="",t.className=this.baseClass+t.className}function activateArea(e){if(!_liveAreas){_activeAreaName=e;return}for(var t=0,n;n=stages[t];++t)n.updateActiveArea(e);_activeAreaName=e,DocumentRolesGenerator()._layout_descs()}function getActiveArea(){return _activeAreaName}function bringLive(){var e=ApplicationConfig();_liveAreas=!0,e.state.livepage=!0,e.reflectState(),_activeAreaName?activateArea(_activeAreaName):e.isPageState("authenticated")?activateArea(e.getAuthenticatedArea()):activateArea(e.getIntroductionArea())}function onPageLoad(e){var t=ApplicationConfig();_liveAreas=!0,t.state.livepage=!0,t.updateState()}function _ApplicationConfig(){this.config={},this._gather(),this._apply(),setTimeout(bringLive,60)}var essential=Resolver("essential",{}),ObjectType=essential("ObjectType"),console=essential("console"),ArraySet=essential("ArraySet"),baseUrl=location.href.substring(0,location.href.split("?")[0].lastIndexOf("/")+1);essential.set("HTMLScriptElement",HTMLScriptElement);var pastloadScripts={};essential.set("_queueDelayedAssets",_queueDelayedAssets);var requiredConfigs={};essential.set("configRequired",configRequired),essential.set("configLoaded",configLoaded),essential.declare("addEventListeners",addEventListeners),DialogAction.prototype.activateArea=activateArea;var DialogActionGenerator=essential.set("DialogAction",Generator(DialogAction)),DocumentRolesGenerator=essential.set("DocumentRoles",Generator(DocumentRoles));DocumentRoles.args=[ObjectType({name:"handlers"})],DocumentRoles.prototype._enhance_descs=function(){var e=ApplicationConfig(),t=!1,n=0;for(var r=0,i;i=this.descs[r];++r)!i.enhanced&&this.handlers.enhance[i.role]&&(i.instance=this.handlers.enhance[i.role].call(this,i.el,i.role,e.getConfig(i.el)),i.enhanced=i.instance===!1?!1:!0,++n),i.enhanced||(t=!0);if(!t&&n>0)for(var r=0,s;s=this._on_event[r];++r){var o=[];for(var u=0,i;i=this.descs[u];++u)(s.role==null||s.role==i.role)&&o.push(i);s.type=="enhanced"&&s.func.call(this,this,o)}},DocumentRoles.discarded=function(e){var t=ApplicationConfig();for(var n=0,r;r=e.descs[n];++n)r.discarded||(e.handlers.discard[r.role]?e.handlers.discard[r.role].call(e,r.el,r.role,r.instance):DocumentRoles.default_discard.call(e,r.el,r.role,r.instance),r.discarded=!0,callCleaners(r))},DocumentRoles.prototype._role_descs=function(e){var t=ApplicationConfig(),n=[];for(var r=0,i;i=e[r];++r){var s=i.getAttribute("role");s&&n.push({role:s,el:i,instance:null,layout:{},enhanced:!1,discarded:!1})}return n},DocumentRoles.prototype._resize_descs=function(){for(var e=0,t;t=this.descs[e];++e)if(t.enhanced&&this.handlers.layout[t.role]){var n=t.el.offsetWidth,r=t.el.offsetHeight;if(t.layout.width!=n||t.layout.height!=r)t.layout.width=n,t.layout.height=r,this.handlers.layout[t.role].call(this,t.el,t.layout,t.instance)}},DocumentRoles.prototype._layout_descs=function(){for(var e=0,t;t=this.descs[e];++e)if(t.enhanced&&this.handlers.layout[t.role]){var n=!1,r=t.el.offsetWidth,i=t.el.offsetHeight;r==0&&i==0&&(t.layout.displayed&&(n=!0),t.layout.displayed=!1);if(t.layout.width!=r||t.layout.height!=i)t.layout.width=r,t.layout.height=i,n=!0;t.layout.area!=_activeAreaName&&(t.layout.area=_activeAreaName,n=!0),n&&this.handlers.layout[t.role].call(this,t.el,t.layout,t.instance)}},DocumentRoles.prototype._area_changed_descs=function(){for(var e=0,t;t=this.descs[e];++e)t.enhanced&&this.handlers.layout[t.role]&&(t.layout.area=_activeAreaName,this.handlers.layout[t.role].call(this,t.el,t.layout,t.instance))},DocumentRoles.prototype.on=function(e,t,n){arguments.length==2&&(n=t),this._on_event.push({type:e,func:n,name:e,role:t})},DocumentRolesGenerator.presets.declare("handlers.enhance",{}),DocumentRolesGenerator.presets.declare("handlers.layout",{}),DocumentRolesGenerator.presets.declare("handlers.discard",{}),DocumentRolesGenerator.enhance_dialog=DocumentRoles.enhance_dialog=function(e,t,n){switch(e.tagName.toLowerCase()){case"form":e.onsubmit=form_onsubmit,e.__builtinSubmit=e.submit,e.submit=form_submit,e.__builtinBlur=e.blur,e.blur=form_blur,e.__builtinFocus=e.focus,e.focus=form_focus;break;default:e.submit=dialog_submit}return addEventListeners(e,{click:dialog_button_click},!1),{}},DocumentRolesGenerator.layout_dialog=DocumentRoles.layout_dialog=function(e,t,n){},DocumentRolesGenerator.discard_dialog=DocumentRoles.discard_dialog=function(e,t,n){},DocumentRolesGenerator.enhance_toolbar=DocumentRoles.enhance_toolbar=function(e,t,n){return e.submit=toolbar_submit,addEventListeners(e,{click:dialog_button_click},!1),{}},DocumentRolesGenerator.layout_toolbar=DocumentRoles.layout_toolbar=function(e,t,n){},DocumentRolesGenerator.discard_toolbar=DocumentRoles.discard_toolbar=function(e,t,n){},DocumentRolesGenerator.enhance_sheet=DocumentRoles.enhance_sheet=function(e,t,n){return{}},DocumentRolesGenerator.layout_sheet=DocumentRoles.layout_sheet=function(e,t,n){},DocumentRolesGenerator.discard_sheet=DocumentRoles.discard_sheet=function(e,t,n){},DocumentRolesGenerator.enhance_spinner=DocumentRoles.enhance_spinner=function(e,t,n){var r={lines:8,length:5,width:5,radius:8,color:"#fff",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:n.zIndex!=undefined?n.zIndex:2e9,top:"auto",left:"auto"};return(new Spinner(r)).spin(e)},DocumentRolesGenerator.layout_spinner=DocumentRoles.layout_spinner=function(e,t,n){},DocumentRolesGenerator.discard_spinner=DocumentRoles.discard_spinner=function(e,t,n){n.stop(),e.innerHTML=""},DocumentRolesGenerator.enhance_application=DocumentRoles.enhance_application=function(e,t,n){n.variant;if(n.generator){var r=_lookup_generator(n.generator,n.resolver);if(r){var i=r(e,t,n);return i}return!1}return{}},DocumentRolesGenerator.layout_application=DocumentRoles.layout_application=function(e,t,n){},DocumentRolesGenerator.discard_application=DocumentRoles.discard_application=function(e,t,n){},DocumentRoles.default_enhance=function(e,t,n){return{}},DocumentRoles.default_layout=function(e,t,n){},DocumentRoles.default_discard=function(e,t,n){};var LayouterGenerator=essential.declare("Layouter",Generator(Layouter)),stages=[],StageLayouterGenerator=essential.declare("StageLayouter",Generator(StageLayouter));LayouterGenerator.variant("area-stage",StageLayouterGenerator),StageLayouter.prototype.refreshClass=function(e){var t=[];for(var n=0,r;r=this.areaNames[n];++n)r==this.activeArea?t.push(r+"-area-active"):t.push(r+"-area-inactive");var i=this.baseClass+t.join(" ");e.className!=i&&(e.className=i)},StageLayouter.prototype.updateActiveArea=function(e){this.activeArea=e,this.refreshClass(document.getElementById(this.key))};var LaidoutGenerator=essential.declare("Laidout",Generator(Laidout)),MemberLaidoutGenerator=essential.declare("MemberLaidout",Generator(MemberLaidout));LaidoutGenerator.variant("area-member",MemberLaidoutGenerator);var _activeAreaName,_liveAreas=!1;essential.set("activateArea",activateArea),essential.set("getActiveArea",getActiveArea),window.addEventListener?window.addEventListener("load",onPageLoad,!1):window.attachEvent&&window.attachEvent("onload",onPageLoad);var ApplicationConfig=Generator(_ApplicationConfig);essential.set("ApplicationConfig",ApplicationConfig).restrict({singleton:!0,lifecycle:"page"}),ApplicationConfig.presets.declare("state",{livepage:!1,authenticated:!1,loading:!0,loadingConfig:!0,loadingScripts:!0,launched:!1}),ApplicationConfig.prototype.isPageState=function(e){return this.state[e]},ApplicationConfig.prototype.setPageState=function(e,t){this.state[e]=t,this.state.launched&&this.updateState()},ApplicationConfig.prototype.getAuthenticatedArea=function(){return"sp-explorer"},ApplicationConfig.prototype.getIntroductionArea=function(){return"sp-explorer"},ApplicationConfig.prototype.declare=function(e,t){this.config[e]=t},ApplicationConfig.prototype._apply=function(){for(var e in this.config){var t=this.config[e],n=this.getElement(e);t.layouter&&(n.layouter=LayouterGenerator.variant(t.layouter)(e,n,t)),t.laidout&&(n.laidout=LaidoutGenerator.variant(t.laidout)(e,n,t))}};var _singleQuotesRe=new RegExp("'","g");ApplicationConfig.prototype._getElementRoleConfig=function(e){var t=e.getAttribute("data-role");if(t)try{var n=JSON.parse("{"+t.replace(_singleQuotesRe,'"')+"}");return e.id&&(this.config[e.id]=n),n}catch(r){return console.debug("Invalid config: ",t,r),{"invalid-config":t}}return{}},ApplicationConfig.prototype.getConfig=function(e){if(e.id)return this.config[e.id]||this._getElementRoleConfig(e);var t=e.getAttribute("name");if(t){var n=e.parentNode;while(n){if(n.id)return this.config[n.id+"."+t]||this._getElementRoleConfig(e);n=n.parentNode}}return this._getElementRoleConfig(e)},ApplicationConfig.prototype.getElement=function(e){var t=e.split("."),n=document.getElementById(t[0]);return t.length>1&&(n=n.getElementByName(t[1])),n},ApplicationConfig.prototype.justUpdateState=function(){this.state.loading=!1,this.state.loadingScripts=!1,this.state.loadingConfig=!1;for(var e in pastloadScripts)pastloadScripts[e]==0&&(this.state.loading=!0,this.state.loadingScripts=!0,console.debug(e+" missing"));for(var e in requiredConfigs)requiredConfigs[e]==0&&(this.state.loading=!0,this.state.loadingConfig=!0,console.debug(e+" missing"));this.state.loading==0&&this.state.launched==0&&document.body&&essential("instantiatePageSingletons")()},ApplicationConfig.prototype.updateState=function(){this.justUpdateState(),this.state.loading==0&&(document.body&&essential("instantiatePageSingletons")(),enhanceUnhandledElements()),this.reflectState()},ApplicationConfig.prototype.reflectState=function(){if(document.body==null)return;var e=ArraySet.apply(null,document.body.className.split(" "));e.set("login",!this.state.authenticated),e.set("authenticated",this.state.authenticated),e.set("loading",this.state.loading),e.set("login-error",this.state.loginError),e.set("launched",this.state.launched),e.set("launching",this.state.launching),e.set("livepage",this.state.livepage),console.debug("Changing body from '"+document.body.className+"' to '"+e.join(" ")+"'"),document.body.className=e.join(" ")}}(),Resolver("essential")("ApplicationConfig").prototype._gather=function(){var scripts=document.getElementsByTagName("script");for(var i=0,s;s=scripts[i];++i)if(s.getAttribute("type")=="application/config")with(this)eval(s.text)}